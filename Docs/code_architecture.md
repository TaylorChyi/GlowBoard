# GlowBoard 代码架构

为降低模块耦合并便于多人协作，GlowBoard 建议采用分层的包结构。整体划分为展示层、业务层和数据层，各层通过协议进行解耦，具体如下：

## 分层说明

- **展示层（Presentation）**：SwiftUI 视图与界面状态管理，负责用户交互与视觉呈现。此层通过依赖业务层提供的接口刷新界面。
- **业务层（Domain）**：定义核心模型 `Script`、滚动控制逻辑以及外部控制协议。公开的接口尽量使用协议，隐藏具体实现细节，方便单元测试与并行开发。
- **数据层（Infrastructure）**：实现 Core Data/CloudKit 持久化、文件导入导出及远程连接等。此层依赖业务层定义的协议，对外只暴露必要的存取方法。

## 模块化拆分

建议在 `Sources/` 目录下为每个主要功能建立独立子目录或 Swift Package，示例结构：

```
Sources/
├── Presentation/       # SwiftUI 视图
├── Domain/             # 业务模型与接口
├── Infrastructure/     # 数据与外部依赖实现
└── App/
    └── main.swift      # 应用入口
```

每个模块内再按功能进一步拆分文件，例如在 `Domain` 中将文本滚动、语音控制、远程控制分别建成子目录。测试代码在 `Tests/` 下镜像同样的结构，可并行开发互不干扰。

## 解耦原则

1. **使用协议和依赖注入**：各层只通过协议交互，具体实现由外层注入，避免直接依赖具体类。
2. **公共模型集中定义**：如 `Script` 等实体放在 `Domain` 层，供多模块共享，减少重复定义。
3. **严格分层依赖**：展示层依赖业务层，业务层依赖数据层接口。禁止反向依赖，避免循环引用。
4. **保持文件粒度适中**：每个文件专注单一功能，如一个滚动引擎文件只处理动画逻辑，数据管理文件只处理数据存取。

通过以上设计，可以在不同层或模块各自迭代，降低合并冲突的概率，同时让测试覆盖更容易集中在业务逻辑上。此结构与 [system_design.md](system_design.md) 中的技术选型相配合，利于后续扩展功能。 
